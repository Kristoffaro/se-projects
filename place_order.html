<!DOCTYPE html>
<html lang="en">

<head>
  <title>Movie Max Order Review</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="mmax.css">
  <script src="mmax.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
</head>

<body class="bg-forms">

  <!-- Header from mmax.js -->
  <div id="header"></div>

  <!-- Checkout forms -->
  <div class="container">
    <h2>Let's review</h2>

    <div class="row">
      <div class="col-sm-5">
        <div class="forms shadow p-3 mb-5 bg-white rounded">

          <div class="form-group">
            <span class="gray">Billing address </span> <a href="#edit_add" class="dashed" data-toggle="collapse">
              edit</a>
            <br>
            <script>document.write(url_query('cardAdd1').replace('+', ' '))</script>
          </div>
          <div id="edit_add" class="collapse">
            <form action="#">
              <div class="form-group">
                <input type="text" class="form-control my-2" id="cardAdd1" placeholder="address" name="cardAdd1"
                  required="required">
                <input type="hidden" id="invisType" name="cardType">
                <script>document.getElementById('invisType').setAttribute('value', url_query('cardType'))</script>
                <input type="hidden" id="invisName" name="cardname">
                <script>document.getElementById('invisName').setAttribute('value', url_query('cardname'))</script>
                <input type="hidden" id="invisNum" name="cardnum">
                <script>document.getElementById('invisNum').setAttribute('value', url_query('cardnum'))</script>
                <input type="hidden" id="invisVal" name="valid">
                <script>document.getElementById('invisVal').setAttribute('value', url_query('valid'))</script>
                <input type="hidden" id="invisCVV" name="cvv">
                <script>document.getElementById('invisCVV').setAttribute('value', url_query('cvv'))</script>
              </div>
              <input type="submit" class="btn btn-primary" value="Save Changes">
              <input type="reset" class="btn btn-default" value="Cancel">
            </form>
          </div>
        </div>

        <div class="forms shadow p-3 mb-5 bg-white rounded">
          <div class="form-group">
            <span class="gray">Payment method </span> <a href="#edit_card" class="dashed" data-toggle="collapse">
              edit</a>
            <br>
            <script>document.write(url_query('cardType'))</script>
          </div>
          <div id="edit_card" class="collapse">
            <form action="#">
              <input type="hidden" id="invisAdd" name="cardAdd1">
              <script>document.getElementById('invisAdd').setAttribute('value', url_query('cardAdd1'))</script>
              <span class="gray">Select a payment method</span><br>
              <input type="radio" name="cardType" id="visa" value="visa" checked>
              <label for="visa">Visa</label>
              <input type="radio" name="cardType" id="mc" value="mc">
              <label for="mc">Mastercard</label>
              <input type="radio" name="cardType" id="discover" value="discover">
              <label for="discover">Discover</label>
              <div class="form-group">
                <label for="cardname">Name on card:</label>
                <input type="text" class="form-control" id="cardname" name="cardname" required="required"
                  pattern="[A-Za-z0-9]{1,30}">
              </div>
              <div class="form-group">
                <label for="cardnum">Card number:</label>
                <input type="text" class="form-control" id="cardnum" name="cardnum" required="required"
                  pattern="[0-9]{13,19}">
              </div>
              <div class="form-group">
                <label for="valid">Valid thru</label>
                <input type="text" maxlength="5" size="3" id="valid" name="valid" required="required"
                  pattern="^(0[1-9]|1[0-2])\/?(([0-9]{4}|[0-9]{2})$)">
                &nbsp;&nbsp;&nbsp;
                <label for="valid">CVV</label>
                <input type="text" maxlength="3" size="1" id="cvv" name="cvv" required="required" pattern="[0-9]{1,3}">
              </div>
              <div class="form-group form-check">
                <label class="form-check-label">
                  <input class="form-check-input" type="checkbox" name="addCard"> add card to my account
                </label>
              </div>
              <input type="submit" class="btn btn-primary" value="Save Changes">
              <input type="reset" class="btn btn-default" value="Cancel">
            </form>
          </div>
        </div>
      </div>
      <script>
        document.getElementById('cardname').setAttribute('placeholder', url_query('cardname'))
        document.getElementById('cardnum').setAttribute('placeholder', url_query('cardnum'))
        document.getElementById('valid').setAttribute('placeholder', url_query('valid'))
        document.getElementById('cvv').setAttribute('placeholder', url_query('cvv'))
        document.getElementById('cardAdd1').setAttribute('placeholder', url_query('cardAdd1'))
        if (url_query('cardType') === 'mc') {
          document.getElementById('mc').setAttribute('checked', true)
        } else if (url_query('cardType') === 'discover') {
          document.getElementById('discover').setAttribute('checked', true)
        }

      </script>
      <div class="col-sm-1"></div>

      <div class="col-sm-5 forms shadow p-3 mb-5 bg-white rounded">
        <form action="./account/library.html">
          <span class="gray">ORDER SUMMARY </span> <a href="cart.html" class="dashed"> edit</a><br><br>
          <table class="table table-striped">
            <tr>
              <td>Price</td>
              <td>
                <script>document.write('$' + checkoutPrice)</script>
              </td>
            </tr>
          </table>
          <table class="table table-borderless">
            <tbody>
              <tr class="gray-bg">
                <td>Subtotal</td>
                <td>
                  <script>document.write('$' + checkoutPrice)</script>
                </td>
              </tr>
              <tr>
                <td>Sales tax</td>
                <td>
                  <script>document.write('$' + checkoutTax)</script>
                </td>
              </tr>
              <tr class="gray gray-bg">
                <td>Total</td>
                <td>
                  <script>document.write('$' + checkoutTotal)</script>
                </td>
              </tr>
            </tbody>
          </table>



          <button type="button" class="btn btn-primary" onclick="updateUserOwned()">Place Order</button>

          <script>
            const user_post_endpoint = "https://g7jn2eiov9.execute-api.us-east-2.amazonaws.com/prod-live/user/";

            function updateUserOwned() {
              var data = {};
              data.UserName = userId;
              data.Password = userPass;
              data.Email = userEmail;
              data.CreditCard = userCred;
              data.Address = userAddress;
              data.Owned = userOwned.concat(", " + movieTitle);
              data.Rented = userRented;
              data.SearchHistory = userSearched;
              data.Favorite = userFav;

              var json = JSON.stringify(data);

              var request = new XMLHttpRequest();
              request.open("POST", user_post_endpoint + data.UserName, true);
              request.setRequestHeader('Content-type', 'application/json; charset=utf-8');
              request.onload = function () {
                var users = JSON.parse(request.responseText);
                if (request.readyState == 4 && request.status == "201") {
                  console.table(users);
                } else {
                  console.error(users);
                }
              }
              request.send(json);
              request.onloadend = function () {
                localStorage.setItem("userOwned", userOwned.concat(", " + movieTitle));
                window.location.href = "./account/library.html";
              }
            }
          </script>

          * By placing this order, you agree to the <a class="dashed" href="/se-projects/terms.html">
            Terms of Use</a> and <a class="dashed" href="/se-projects/privacy.html">Privacy Policy</a>
        </form>

      </div>
    </div>


  </div>


  <!-- Default Footer with links from mmax.js-->
  <div id="footer" class="row justify-content-*-center"></div>

  <script>
    if (loggedIn === 'true') {
      document.getElementById("header").innerHTML = header_loggedIn;
    } else {
      document.getElementById("header").innerHTML = header;
    }
    document.getElementById("footer").innerHTML = footer;
  </script>

</body>

</html>